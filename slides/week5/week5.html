<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Week 5</title>
<meta name="author" content="(Jason Gibson)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://robojackets.github.io/reveal.js/css/reveal.css"/>

<link rel="stylesheet" href="https://robojackets.github.io/reveal.js/css/theme/white.css" id="theme"/>


<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://robojackets.github.io/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">Week 5</h1>
</section>

<section id="slide-orgabf0a5a">
<h2 id="orgabf0a5a">What are we doing today</h2>
<ul>
<li>Look at solutions from last week</li>
<li>GPS</li>
<li>Review command line tools</li>
<li>How tf?</li>
<li>Write a node to find an object using tf</li>

</ul>
</section>
<section id="slide-org89be85d">
<h2 id="org89be85d">Solutions from last week</h2>
</section>
<section id="slide-org028726a">
<h2 id="org028726a">GPS</h2>
<ul>
<li>Global positioning system</li>
<li>Created by the military</li>
<li>Triangulates postion based on multiple satellites
<ul>
<li>Relies on atmoic clocks</li>
<li>satellites publish times and receivers use equation to find its position
<ul>
<li>Requires 4 satellites, typically want closer to 7</li>

</ul></li>

</ul></li>

</ul>
</section>
<section id="slide-org6a38dea">
<h3 id="org6a38dea">Filters and base stations</h3>
<ul>
<li>Make assumptions to correct for noise</li>
<li>Base station (RTK, real time kinematic)
<ul>
<li>Assumes it is not moving</li>
<li>Have two in parallel and use this one to correct for noise</li>
<li>Global base stations</li>
<li>Can get cm accuracy</li>

</ul></li>

</ul>
</section>
<section id="slide-orgc38619b">
<h3 id="orgc38619b">Almanacs</h3>
<ul>
<li>Where to look for the satellites
<ul>
<li>Estimated position over time stored</li>
<li>Check there first</li>

</ul></li>
<li>Based off of last location</li>

</ul>
</section>
<section id="slide-orgbccba1e">
<h2 id="orgbccba1e">Review</h2>
<div class="outline-text-2" id="text-orgbccba1e">
</div>
</section>
<section id="slide-org9a899c4">
<h3 id="org9a899c4">What are the three files every node needs?</h3>
<div class="outline-text-3" id="text-org9a899c4">
</div>
</section>
<section id="slide-org1657911">
<h4 id="org1657911">What are the three files every node needs?</h4>
<ul>
<li>CMakeLists.txt</li>
<li>package.xml</li>
<li>a source file</li>

</ul>
</section>
<section id="slide-orga61bfc2">
<h3 id="orga61bfc2">What is in a CMakeLists.txt file?</h3>
<div class="outline-text-3" id="text-orga61bfc2">
</div>
</section>
<section id="slide-org5153d05">
<h4 id="org5153d05">What is in a CMakeLists.txt file?</h4>
<ul>
<li>How to build the node
<ul>
<li>Defines the structure of the package for the compile</li>
<li>Linking the executable ROS nodes to the appropriate libraries (OpenCV, PCL, etc..)</li>

</ul></li>

</ul>
</section>
<section id="slide-orga956c01">
<h3 id="orga956c01">What is in the package.xml file?</h3>
<div class="outline-text-3" id="text-orga956c01">
</div>
</section>
<section id="slide-orgb1a187e">
<h4 id="orgb1a187e">What is in the package.xml file?</h4>
<ul>
<li>What are the dependencies of a node</li>
<li>maintainer information, author, etc</li>

</ul>
</section>
<section id="slide-org2f5885d">
<h3 id="org2f5885d">What is required for a subscriber?</h3>
<div class="outline-text-3" id="text-org2f5885d">
</div>
</section>
<section id="slide-org83b01b9">
<h4 id="org83b01b9">What is required for a subscriber?</h4>
<ul>
<li>Callback function</li>
<li>Topic name</li>
<li>Queue size</li>

</ul>
</section>
<section id="slide-orge2af1c4">
<h3 id="orge2af1c4">What is required for a publisher?</h3>
<div class="outline-text-3" id="text-orge2af1c4">
</div>
</section>
<section id="slide-org322a0db">
<h4 id="org322a0db">What is required for a publisher?</h4>
<ul>
<li>Topic name</li>
<li>Queue size</li>

</ul>
</section>
<section id="slide-org8570cb6">
<h3 id="org8570cb6">What things must be done in every node?</h3>
<div class="outline-text-3" id="text-org8570cb6">
</div>
</section>
<section id="slide-orgc9ad220">
<h4 id="orgc9ad220">What things must be done in every node?</h4>
<ul>
<li>include ros header</li>
<li>ros::init</li>
<li>Create NodeHandle</li>
<li>ros spin</li>

</ul>
</section>
<section id="slide-org18612e4">
<h3 id="org18612e4">How do I get what nodes are currently running?</h3>
<div class="outline-text-3" id="text-org18612e4">
</div>
</section>
<section id="slide-org5ceabf0">
<h4 id="org5ceabf0">How do I get what nodes are currently running?</h4>
<ul>
<li>rosnode list</li>

</ul>
</section>
<section id="slide-org6b5c9cb">
<h3 id="org6b5c9cb">How do I get information about a running node?</h3>
<div class="outline-text-3" id="text-org6b5c9cb">
</div>
</section>
<section id="slide-org5c88ec6">
<h4 id="org5c88ec6">How do I get information about a running node?</h4>
<ul>
<li>rosnode info [NAME]</li>

</ul>
</section>
<section id="slide-org7722bb9">
<h3 id="org7722bb9">How do I get a list of the topic currently publishing?</h3>
<div class="outline-text-3" id="text-org7722bb9">
</div>
</section>
<section id="slide-orgfbc5edf">
<h4 id="orgfbc5edf">How do I get a list of the topic currently publishing?</h4>
<ul>
<li>rostopic list</li>

</ul>
</section>
<section id="slide-org73916f3">
<h3 id="org73916f3">How do I get how often a topic is publishing?</h3>
<div class="outline-text-3" id="text-org73916f3">
</div>
</section>
<section id="slide-org97d9d50">
<h4 id="org97d9d50">How do I get how often a topic is publishing?</h4>
<ul>
<li>rostopic hz [NAME]</li>

</ul>
</section>
<section id="slide-org747d74a">
<h3 id="org747d74a">How do I get what is being published on a topic?</h3>
<div class="outline-text-3" id="text-org747d74a">
</div>
</section>
<section id="slide-org256776d">
<h4 id="org256776d">How do I get what is being published on a topic?</h4>
<ul>
<li>rostopic echo [NAME]</li>

</ul>
</section>
<section id="slide-orgfc7eecb">
<h2 id="orgfc7eecb">Transforms</h2>
<ul>
<li>This is going to be very high level
<ul>
<li>Lots of linear algebra</li>

</ul></li>

</ul>
</section>
<section id="slide-org1351cc0">
<h3 id="org1351cc0">Coordinate frame</h3>
<ul>
<li>A (X,Y,Z) point in space and an orientation that things are relative to</li>
<li>You can have multiple in the same world</li>
<li><a href="http://www.ros.org/reps/rep-0103.html#coordinate-frame-conventions">standards</a></li>

</ul>
</section>
<section id="slide-org7faa82b">
<h3 id="org7faa82b">Pose</h3>
<ul>
<li>Name for location of a robot relative to a coordinate frame</li>
<li>(X,Y,Z) (R,P,Y)</li>

</ul>
</section>
<section id="slide-org596d6fb">
<h3 id="org596d6fb">All data is in a coordinate frame</h3>
<ul>
<li>Remember the lidar from last week?
<ul>
<li>That data was in reference to the lidar</li>

</ul></li>

</ul>
</section>
<section id="slide-org7a1c68e">
<h3 id="org7a1c68e">UTM</h3>
<ul>
<li>Universal Transverse Mercator coordinate system
<ul>
<li>Used by IGVC</li>

</ul></li>
<li>Divides the entire world into a grid</li>
<li>Referred to as northing (+Y) easting (+X)
<ul>
<li>Same as geographic coordinate frame</li>

</ul></li>

</ul>
</section>
<section id="slide-orgd2c3c0a">
<h3 id="orgd2c3c0a">Example coordinate frames</h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">standard</th>
<th scope="col" class="org-left">X</th>
<th scope="col" class="org-left">Y</th>
<th scope="col" class="org-left">Z</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">urdf</td>
<td class="org-left">forward</td>
<td class="org-left">left</td>
<td class="org-left">up</td>
</tr>

<tr>
<td class="org-left">UTM</td>
<td class="org-left">right</td>
<td class="org-left">forward</td>
<td class="org-left">up</td>
</tr>

<tr>
<td class="org-left">camera</td>
<td class="org-left">left</td>
<td class="org-left">up</td>
<td class="org-left">forward</td>
</tr>
</tbody>
</table>
</section>
<section id="slide-org4d5f358">
<h3 id="org4d5f358">Using tf2 to do transforms</h3>
<ul>
<li>Calculating coordinate transforms is hard</li>
<li>Let ROS do it for you
<ul>
<li>Yay tf</li>

</ul></li>

</ul>
</section>
<section id="slide-orge81dca3">
<h4 id="orge81dca3">transform direction</h4>
<ul>
<li>Always transforms from one coordiante frame to another</li>
<li>Each link is its own coordinate frame</li>
<li>transform the coordinate frame <code>"frame_id"</code> into <code>"child_frame_id"</code></li>

</ul>
</section>
<section id="slide-orge0f54f4">
<h4 id="orge0f54f4">Wait!</h4>
<ul>
<li>You usually have to wait for the transform to become available</li>

</ul>
<div class="org-src-container">

<pre  class="src src-C++"><span style="color: #15968D;">tf</span>::<span style="color: #598249;">TransformListener</span> <span style="color: #2F7BDE;">tf_listener</span>;
<span style="color: #5e6263;">// </span><span style="color: #5e6263;">transfroms source -&gt; target</span>
<span style="color: #5e6263;">// </span><span style="color: #5e6263;">target, source, when to do it, how long to wait</span>
<span style="color: #598249;">if</span>(tf_listener.waitForTransform(<span style="color: #15968D;">"[TARGET]"</span>, <span style="color: #15968D;">"[SOURCE]"</span>, <span style="color: #15968D;">ros</span>::Time(0), <span style="color: #15968D;">ros</span>::Duration(3.0))) {
<span style="color: #5e6263;">// </span><span style="color: #5e6263;">DO it</span>
}
</pre>
</div>
</section>
<section id="slide-orge0875a4">
<h4 id="orge0875a4">Do It</h4>
<div class="org-src-container">

<pre  class="src src-C++"><span style="color: #15968D;">tf</span>::<span style="color: #598249;">TransformListener</span> <span style="color: #2F7BDE;">tf_listener</span>;
<span style="color: #5e6263;">// </span><span style="color: #5e6263;">transfroms source -&gt; target</span>
<span style="color: #5e6263;">// </span><span style="color: #5e6263;">target, source, when to do it, how long to wait</span>
<span style="color: #598249;">if</span>(tf_listener.waitForTransform(<span style="color: #15968D;">"[TARGET]"</span>, <span style="color: #15968D;">"[SOURCE]"</span>, <span style="color: #15968D;">ros</span>::Time(0), <span style="color: #15968D;">ros</span>::Duration(3.0))) {
  <span style="color: #5e6263;">// </span><span style="color: #5e6263;">source -&gt; target</span>
  <span style="color: #5e6263;">// </span><span style="color: #5e6263;">target, source, when, result</span>
  tf_listener.lookupTransform(<span style="color: #15968D;">"/base_link"</span>, <span style="color: #15968D;">"/ball"</span>, <span style="color: #15968D;">ros</span>::Time(0), transform);
}
</pre>
</div>
</section>
<section id="slide-orgc520918">
<h2 id="orgc520918">Commands</h2>
<div class="outline-text-2" id="text-orgc520918">
</div>
</section>
<section id="slide-org67ef45c">
<h3 id="org67ef45c">Create a diagram</h3>
<ul>
<li><code>rosrun rqt_tf_tree rqt_tf_tree</code></li>
<li>Creates a diagram of all of the tf elements</li>

</ul>
</section>
<section id="slide-orgc715bb4">
<h3 id="orgc715bb4"><code>tf_echo</code></h3>
<ul>
<li><code>rosrun tf tf_echo [source_frame] [target_frame]</code></li>
<li>Publishes the transform to the command line</li>

</ul>
</section>
<section id="slide-org636fca6">
<h2 id="org636fca6">Node writing</h2>
<ul>
<li>We are going to use tf to get the pose of the ball from last week</li>
<li>But first some questions</li>

</ul>
</section>
<section id="slide-org0e6b4d0">
<h3 id="org0e6b4d0">What is the package name?</h3>
<div class="outline-text-3" id="text-org0e6b4d0">
</div>
</section>
<section id="slide-org29435be">
<h4 id="org29435be"><code>follower_2</code></h4>
</section>
<section id="slide-org41760e1">
<h3 id="org41760e1">What are the executables</h3>
<div class="outline-text-3" id="text-org41760e1">
</div>
</section>
<section id="slide-orgd2407e2">
<h4 id="orgd2407e2"><code>tf_pub follower_2</code></h4>
</section>
<section id="slide-orgdeb2b15">
<h3 id="orgdeb2b15">What topics locator does listen to?</h3>
<div class="outline-text-3" id="text-orgdeb2b15">
</div>
</section>
<section id="slide-org47e8d75">
<h4 id="org47e8d75"><code>hal/gazebo/model_states</code></h4>
</section>
<section id="slide-org823abe2">
<h3 id="org823abe2">What type of message is <code>hal/gazebo/model_states</code></h3>
<div class="outline-text-3" id="text-org823abe2">
</div>
</section>
<section id="slide-orgb1d4815">
<h4 id="orgb1d4815"><code>gazebo_msgs::ModelStates</code></h4>
</section>
<section id="slide-orgbd6df96">
<h3 id="orgbd6df96">What would the line for the launch file look like to launch locator</h3>
<div class="outline-text-3" id="text-orgbd6df96">
</div>
</section>
<section id="slide-org48966ad">
<h4 id="org48966ad">&lt;node name="<code>tf_pub</code>" pkg="<code>follower_2</code>" type="<code>tf_pub</code>"&gt;</h4>
</section>
<section id="slide-org7150e23">
<h3 id="org7150e23">What would the line for the launch file look like to launch locator</h3>
<div class="outline-text-3" id="text-org7150e23">
</div>
</section>
<section id="slide-orgab6f7c1">
<h4 id="orgab6f7c1">&lt;node name="<code>follower_2</code>" pkg="<code>follower_2</code>" type="<code>follower_2</code>"&gt;</h4>
</section>
<section id="slide-orgd0d9269">
<h3 id="orgd0d9269">Will this work?</h3>
<ul>
<li>&lt;node name="namenamename" pkg="<code>follower_2</code>" type="<code>tf_pub</code>" output="screen"/&gt;</li>

</ul>
</section>
</section>
</div>
</div>
<script src="https://robojackets.github.io/reveal.js/lib/js/head.min.js"></script>
<script src="https://robojackets.github.io/reveal.js/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: false,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
overview: true,
width: 1440,
height: 800,
margin: 0.15,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'fast',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'https://robojackets.github.io/reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
]
});
</script>
</body>
</html>
